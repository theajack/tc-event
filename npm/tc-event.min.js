!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?exports.TEvent=r():e.TEvent=r()}(this,(function(){return function(e){var r={};function t(n){if(r[n])return r[n].exports;var i=r[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,t),i.l=!0,i.exports}return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:n})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var i in e)t.d(n,i,function(r){return e[r]}.bind(null,i));return n},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p="",t(t.s=0)}([function(e,r,t){"use strict";function n(e){return void 0===e}function i(e,r,t){var n=e.length;return 0===n?0:function e(r,t,n,i,o){var s=Math.floor((t+n)/2);if(t>n)return s+1;return r[s].order>i?e(r,t,s-1,i,o):r[s].order<i?e(r,s+1,n,i,o):o?0===s||r[s-1].order<i?s:e(r,t,s-1,i,o):s===r.length-1||r[s+1].order>i?s+1:e(r,s+1,n,i,o)}(e,0,n-1,r,t)}function o(){var e=[],r=!1;return{add:function(t){var n=t.index,i=t.func;r?e.push({index:n,func:i}):i()},lock:function(t){r=!0;var n=t();return function(){if(0!==e.length){e.sort((function(e,r){return r.index-e.index}));for(var r=0;r<e.length;r++)e[r].func();e=[]}}(),r=!1,n}}}var s;t.r(r),t.d(r,"registBase",(function(){return x}));var u;var f=function(){return(f=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++)for(var i in r=arguments[t])Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i]);return e}).apply(this,arguments)},c=function(){function e(e){this.name=e,this._init()}return e.prototype._init=function(){this._locker=o(),this._triggerData=void 0,this.order=0,this.hasTrigger=!1,this.id=0,this.singleMode=!1,this.listeners=[]},e.prototype._countInsertIndex=function(e){var r,t=e.index,n=e.order,o=e.orderBefore,s=void 0!==o&&o,u=this.listeners.length;if("number"==typeof t){t>u?t=u:t<0&&(t=0);var f=this.listeners[t];n=f?f.order:++this.order,r=t}else"number"!=typeof n&&(n=++this.order),r=0===u||n>this._findLastOrder()?u:i(this.listeners,n,s);return{insertIndex:r,order:n}},e.prototype.regist=function(e){var r,t=this,n=e.listener,i=e.once,o=void 0!==i&&i,u=e.immediate,f=void 0===u||u,c=e.order,d=e.orderBefore,a=void 0!==d&&d,l=e.index,h=e.single,v=void 0!==h&&h;if(this.singleMode=this.singleMode||v,this.singleMode)this.listeners=[],r=0,c=0;else{var p=this._countInsertIndex({index:l,order:c,orderBefore:a});r=p.insertIndex,c=p.order}var g,m={name:this.name,listener:n,once:o,immediate:f,hasTrigger:!1,order:c,id:++this.id,single:this.singleMode};return g={name:this.name,item:m},s&&s(g),this._locker.add({index:r,func:function(){t.listeners.splice(r,0,m)}}),f&&this.hasTrigger&&(o&&(m.hasTrigger=!0),n(this._triggerData,this._buildListenOption({firstEmit:!1,id:m.id}))),m},e.prototype._findLastOrder=function(){for(var e=this.listeners.length-1;e>=0;e--)if(this.listeners[e])return this.listeners[e].order;return 0},e.prototype._buildListenOption=function(e){var r=this,t=e.firstEmit,n=e.id;return{firstEmit:t,remove:function(){return r.remove(n)},clear:function(){return r.clear()}}},e.prototype.emit=function(e){var r=this;return this._locker.lock((function(){var t,n=!1===r.hasTrigger;r.hasTrigger||(r.hasTrigger=!0),r._triggerData=e;for(var i=0;i<r.listeners.length;i++){var o=r.listeners[i];if(o&&(!o.once||!o.hasTrigger)){o.hasTrigger=!0;var s=r._buildListenOption({firstEmit:n,id:o.id});o.listener(e,s),t=f({name:r.name,item:o,data:e},s),u&&u(t)}}return n}))},e.prototype.remove=function(e,r){var t,n=this;if(void 0===r&&(r=!1),this.singleMode)t=0;else{var i,o=typeof e;if("number"===o)i="id";else{if("function"!==o)return console.warn("removeEvent 传入的参数有误"),!1;i="listener"}var s=this.listeners.find((function(r){return r&&r[i]===e}));if(!s)return!1;t=this.listeners.indexOf(s),r&&(this.listeners[t]=void 0)}return this._locker.add({index:t,func:function(){n.listeners.splice(t,1)}}),!0},e.prototype.clear=function(){return this._init(),!0},e}(),d={},a={};function l(e){return d[p(e)]}function h(e){return n(e)?a:a[p(e)]}function v(){d={},a={},s=void 0,u=void 0}function p(e){return"number"==typeof e?e.toString():e}var g=function(){return(g=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++)for(var i in r=arguments[t])Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i]);return e}).apply(this,arguments)};function m(e){return!!l(e)}function y(e){n(h(e))&&function(e){var r=p(e);d[r]=new c(r),a[r]=r}(e)}function b(e,r){if("object"==typeof e){var t={};for(var n in e)t[n]=b(n,e[n]);return t}return"function"==typeof r?x({name:e,listener:r}):"object"==typeof r?x(g({name:e},r)):void 0!==r||"string"!=typeof e&&"number"!=typeof e?(console.warn("错误的listener",e,r),null):function(e){var r={name:e,listener:function(){}};return{single:function(e){return void 0===e&&(e=!0),r.single=e,this},notImmediate:function(e){return void 0===e&&(e=!1),r.immediate=e,this},once:function(e){return void 0===e&&(e=!0),r.once=e,this},index:function(e){return r.index=e,this},orderBefore:function(e){return void 0===e&&(e=!0),r.orderBefore=e,this},order:function(e){return r.order=e,this},listener:function(e){return r.listener=e,this},listen:function(e){return e&&(r.listener=e),x(r)}}}(e)}function x(e){var r=e.once,t=void 0!==r&&r,n=e.immediate,i=void 0===n||n,o=e.name,s=e.listener,u=e.order,f=e.orderBefore,c=e.index,d=e.single;return m(o)||y(o),l(o).regist({listener:s,once:t,immediate:i,order:u,orderBefore:f,index:c,single:d})}r.default={version:"0.0.5",EVENT:h(),emit:function(e,r){return m(e)||y(e),l(e).emit(r)},onEmit:function(e){u=e},regist:b,onRegist:function(e){s=e},checkEvent:m,remove:function e(r,t,i){if("object"==typeof r)return i=t,null===r?(console.error("参数错误",r),!1):e(r.name,r.id,i);if("object"==typeof r){var o=r;return e(o.name,o.id)}return m(r)?n(t)?(console.error("请传入要移除的listener 或 id"),!1):l(r).remove(t,i):(console.warn("removeEvent:未找到事件 "+r),!1)},clear:function e(r){var t;"string"==typeof r||"number"==typeof r?m(r)&&(l(r).clear(),delete d[p(t=r)],delete a[p(t)]):r instanceof Array?r.forEach((function(r){e(r)})):v()},order:function(e){return m(e)?l(e).order:-1},registNotImmediate:function(e,r){return b(e,{immediate:!1,listener:r})},registNotImmediateOnce:function(e,r){return b(e,{immediate:!1,once:!0,listener:r})},registOnce:function(e,r){return b(e,{once:!0,listener:r})},registSingle:function(e,r){return b(e,{single:!0,listener:r})}}}]).default}));