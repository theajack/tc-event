!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.TEvent=t():e.TEvent=t()}(this,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";function r(e){return void 0===e}function i(e,t,n){var r=e.length;return 0===r?0:function e(t,n,r,i,o){var s=Math.floor((n+r)/2);if(n>r)return s+1;return t[s].order>i?e(t,n,s-1,i,o):t[s].order<i?e(t,s+1,r,i,o):o?0===s||t[s-1].order<i?s:e(t,n,s-1,i,o):s===t.length-1||t[s+1].order>i?s+1:e(t,s+1,r,i,o)}(e,0,r-1,t,n)}function o(){var e=[],t=!1;return{add:function(n){var r=n.index,i=n.func;t?e.push({index:r,func:i}):i()},lock:function(n){t=!0;var r=n();return function(){if(0!==e.length){e.sort((function(e,t){return t.index-e.index}));for(var t=0;t<e.length;t++)e[t].func();e=[]}}(),t=!1,r}}}var s;n.r(t),n.d(t,"registBase",(function(){return x}));var u;var f=function(){return(f=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},a=function(){function e(e){this.eventName=e,this._init()}return e.prototype._init=function(){this._locker=o(),this._triggerData=void 0,this.order=0,this.hasTrigger=!1,this.id=0,this.singleMode=!1,this.listeners=[]},e.prototype._countInsertIndex=function(e){var t,n=e.index,r=e.order,o=e.orderBefore,s=void 0!==o&&o,u=e.head,f=e.tail,a=this.listeners.length;if(u?n=0:f&&(n=a),"number"==typeof n){n>a?n=a:n<0&&(n=0);var c=this.listeners[n===a?n-1:n];r=c?c.order:++this.order,t=n}else"number"!=typeof r&&(r=++this.order),t=0===a||r>this._findLastOrder()?a:i(this.listeners,r,s);return{insertIndex:t,order:r}},e.prototype.regist=function(e){var t,n=this,r=e.listener,i=e.immediate,o=void 0===i||i,u=e.once,f=void 0!==u&&u,a=e.order,c=e.orderBefore,d=void 0!==c&&c,l=e.index,v=e.single,h=void 0!==v&&v,m=e.name,p=void 0===m?"":m,g=e.head,y=void 0!==g&&g,b=e.tail,x=void 0!==b&&b;if(this.singleMode=this.singleMode||h,this.singleMode)this.listeners=[],t=0,a=0;else{var _=this._countInsertIndex({index:l,order:a,orderBefore:d,head:y,tail:x});t=_.insertIndex,a=_.order}var O,j=++this.id,N={eventName:this.eventName,listener:r,once:f,immediate:o,hasTrigger:!1,order:a,id:j,name:p||this.eventName+"-"+j,single:this.singleMode,head:y,tail:x,orderBefore:d};return O={eventName:this.eventName,item:N},s&&s(O),this._locker.add({index:t,func:function(){n.listeners.splice(t,0,N)}}),o&&this.hasTrigger&&(f&&(N.hasTrigger=!0),r(this._triggerData,this._buildListenOption({firstEmit:!1,item:N}))),N},e.prototype._findLastOrder=function(){for(var e=this.listeners.length-1;e>=0;e--)if(this.listeners[e])return this.listeners[e].order;return 0},e.prototype._buildListenOption=function(e){var t=this,n=e.firstEmit,r=e.item;return{firstEmit:n,item:r,remove:function(){return t.remove(r.id)},clear:function(){return t.clear()}}},e.prototype.emit=function(e){var t=this;return this._locker.lock((function(){var n,r=!1===t.hasTrigger;t.hasTrigger||(t.hasTrigger=!0),t._triggerData=e;for(var i=0;i<t.listeners.length;i++){var o=t.listeners[i];if(o&&(!o.once||!o.hasTrigger)){o.hasTrigger=!0;var s=t._buildListenOption({firstEmit:r,item:o});o.listener(e,s),n=f({eventName:t.eventName,data:e},s),u&&u(n)}}return r}))},e.prototype.remove=function(e,t){var n,r=this;if(void 0===t&&(t=!1),this.singleMode)n=0;else{var i,o=typeof e;if("number"===o)i="id";else{if("function"!==o)return console.warn("removeEvent 传入的参数有误"),!1;i="listener"}var s=this.listeners.find((function(t){return t&&t[i]===e}));if(!s)return!1;n=this.listeners.indexOf(s),t&&(this.listeners[n]=void 0)}return this._locker.add({index:n,func:function(){r.listeners.splice(n,1)}}),!0},e.prototype.clear=function(){return this._init(),!0},e}(),c={},d={};function l(e){return c[m(e)]}function v(e){return r(e)?d:d[m(e)]}function h(){c={},d={},s=void 0,u=void 0}function m(e){return"number"==typeof e?e.toString():e}var p=function(){return(p=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function g(e){return!!l(e)}function y(e){r(v(e))&&function(e){var t=m(e);c[t]=new a(t),d[t]=t}(e)}function b(e,t){if("object"==typeof e){var n={};for(var r in e)n[r]=b(r,e[r]);return n}return"function"==typeof t?x({eventName:e,listener:t}):"object"==typeof t?x(p({eventName:e},t)):void 0!==t||"string"!=typeof e&&"number"!=typeof e?(console.warn("错误的listener",e,t),null):function(e){var t={eventName:e,listener:function(){}};return{single:function(e){return void 0===e&&(e=!0),t.single=e,this},notImmediate:function(e){return void 0===e&&(e=!1),t.immediate=e,this},once:function(e){return void 0===e&&(e=!0),t.once=e,this},index:function(e){return t.index=e,this},head:function(){return t.head=!0,this},tail:function(){return t.tail=!0,this},name:function(e){return t.name=e,this},orderBefore:function(e){return void 0===e&&(e=!0),t.orderBefore=e,this},order:function(e){return t.order=e,this},listener:function(e){return t.listener=e,this},listen:function(e){return e&&(t.listener=e),x(t)}}}(e)}function x(e){var t=e.once,n=void 0!==t&&t,r=e.immediate,i=void 0===r||r,o=e.eventName,s=e.listener,u=e.order,f=e.orderBefore,a=e.index,c=e.single,d=e.name,v=e.head,h=e.tail;return g(o)||y(o),l(o).regist({listener:s,once:n,immediate:i,order:u,orderBefore:f,index:a,single:c,name:d,head:v,tail:h})}t.default={version:"0.0.6",EVENT:v(),emit:function(e,t){return g(e)||y(e),l(e).emit(t)},onEmit:function(e){u=e},regist:b,onRegist:function(e){s=e},checkEvent:g,remove:function e(t,n,i){if("object"==typeof t)return i=n,null===t?(console.error("参数错误",t),!1):e(t.eventName,t.id,i);if("object"==typeof t){var o=t;return e(o.eventName,o.id)}return g(t)?r(n)?(console.error("请传入要移除的listener 或 id"),!1):l(t).remove(n,i):(console.warn("removeEvent:未找到事件 "+t),!1)},clear:function e(t){"string"==typeof t||"number"==typeof t?g(t)&&(l(t).clear(),function(e){delete c[m(e)],delete d[m(e)]}(t)):t instanceof Array?t.forEach((function(t){e(t)})):h()},order:function(e){return g(e)?l(e).order:-1},registNotImmediate:function(e,t){return b(e,{immediate:!1,listener:t})},registNotImmediateOnce:function(e,t){return b(e,{immediate:!1,once:!0,listener:t})},registOnce:function(e,t){return b(e,{once:!0,listener:t})},registSingle:function(e,t){return b(e,{single:!0,listener:t})}}}]).default}));