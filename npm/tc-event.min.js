!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.TEvent=t():e.TEvent=t()}(this,(function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";function n(e){return void 0===e}function i(e,t,r){var n=e.length;return 0===n?0:function e(t,r,n,i,o){var u=Math.floor((r+n)/2);if(r>n)return u+1;return t[u].order>i?e(t,r,u-1,i,o):t[u].order<i?e(t,u+1,n,i,o):o?0===u||t[u-1].order<i?u:e(t,r,u-1,i,o):u===t.length-1||t[u+1].order>i?u+1:e(t,u+1,n,i,o)}(e,0,n-1,t,r)}function o(){var e=[],t=!1;return{add:function(r){var n=r.index,i=r.func;t?e.push({index:n,func:i}):i()},lock:function(r){t=!0;var n=r();return function(){if(0!==e.length){e.sort((function(e,t){return t.index-e.index}));for(var t=0;t<e.length;t++)e[t].func();e=[]}}(),t=!1,n}}}var u;r.r(t),r.d(t,"registBase",(function(){return O}));var s;var f=function(){return(f=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function d(e,t,r){if(e&&0!==e.timesLeft){e.hasTrigger=!0,e.timesLeft>0&&e.timesLeft--;var n=v(e.eventName);void 0===r&&(r=!1===n.hasTrigger);var i,o=function(e){var t=e.firstEmit,r=e.item,n=e.event;return{firstEmit:t,item:r,remove:function(){return n.remove(r.id)},clear:function(){return n.clear()}}}({firstEmit:r,item:e,event:n});e.listener(t,o),i=f({eventName:n.eventName,data:t},o),s&&s(i)}}var a=function(){function e(e){this.eventName=e,this._init()}return e.prototype._init=function(){this._locker=o(),this._triggerData=void 0,this.order=0,this.hasTrigger=!1,this.id=0,this.singleMode=!1,this.listeners=[]},e.prototype.regist=function(e){var t,r=this,n=e.listener,o=e.immediate,s=void 0===o||o,f=e.once,a=void 0!==f&&f,c=e.order,l=e.orderBefore,v=void 0!==l&&l,m=e.index,h=e.single,g=void 0!==h&&h,p=e.name,y=void 0===p?"":p,b=e.head,x=void 0!==b&&b,O=e.tail,j=void 0!==O&&O,N=e.times,_=void 0===N?-1:N;if(this.singleMode=this.singleMode||g,this.singleMode)this.listeners=[],t=0,c=0;else{var T=function(e){var t,r=e.listeners,n=e.eventOrder,o=e.index,u=e.order,s=e.orderBefore,f=void 0!==s&&s,d=e.head,a=e.tail,c=r.length,l=!1;if(d?o=0:a&&(o=c),"number"==typeof o){o>c?o=c:o<0&&(o=0);var v=r[o===c?o-1:o];v?u=v.order:(u=n+1,l=!0),t=o}else"number"!=typeof u&&(u=n+1,l=!0),t=0===c||u>function(e){for(var t=e.length-1;t>=0;t--)if(e[t])return e[t].order;return 0}(r)?c:i(r,u,f);return{insertIndex:t,order:u,needAddOrder:l}}({listeners:this.listeners,eventOrder:this.order,index:m,order:c,orderBefore:v,head:x,tail:j});T.needAddOrder&&this.order++,t=T.insertIndex,c=T.order}var E,B=function(e,t){var r=t.listener,n=t.immediate,i=void 0===n||n,o=t.once,u=void 0!==o&&o,s=t.order,f=t.orderBefore,d=void 0!==f&&f,a=t.name,c=void 0===a?"":a,l=t.head,v=void 0!==l&&l,m=t.tail,h=void 0!==m&&m,g=t.times,p=void 0===g?-1:g,y=++e.id;return u&&(p=1),{eventName:e.eventName,listener:r,once:u,immediate:i,hasTrigger:!1,order:s,id:y,name:c||e.eventName+"-"+y,single:e.singleMode,head:v,tail:h,orderBefore:d,times:p,timesLeft:p}}(this,{listener:n,immediate:s,once:a,order:c,orderBefore:v,name:y,head:x,tail:j,times:_});return E={eventName:this.eventName,item:B},u&&u(E),this._locker.add({index:t,func:function(){r.listeners.splice(t,0,B)}}),s&&this.hasTrigger&&d(B,this._triggerData),B},e.prototype.emit=function(e){var t=this;return this._locker.lock((function(){t._triggerData=e;var r=!1===t.hasTrigger;t.hasTrigger||(t.hasTrigger=!0);for(var n=0;n<t.listeners.length;n++)d(t.listeners[n],e,r);return r}))},e.prototype.remove=function(e,t){var r,n=this;if(void 0===t&&(t=!1),this.singleMode)r=0;else{var i,o=typeof e;if("number"===o)i="id";else{if("function"!==o)return console.warn("removeEvent 传入的参数有误"),!1;i="listener"}var u=this.listeners.find((function(t){return t&&t[i]===e}));if(!u)return!1;r=this.listeners.indexOf(u),t&&(this.listeners[r]=void 0)}return this._locker.add({index:r,func:function(){n.listeners.splice(r,1)}}),!0},e.prototype.clear=function(){return this._init(),!0},e}(),c={},l={};function v(e){return c[g(e)]}function m(e){return n(e)?l:l[g(e)]}function h(){c={},l={},u=void 0,s=void 0}function g(e){return"number"==typeof e?e.toString():e}var p=function(){return(p=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function y(e){return!!v(e)}function b(e){n(m(e))&&function(e){var t=g(e);c[t]=new a(t),l[t]=t}(e)}function x(e,t){if("object"==typeof e){var r={};for(var n in e)r[n]=x(n,e[n]);return r}return"function"==typeof t?O({eventName:e,listener:t}):"object"==typeof t?O(p({eventName:e},t)):void 0!==t||"string"!=typeof e&&"number"!=typeof e?(console.warn("错误的listener",e,t),null):function(e){var t={eventName:e,listener:function(){}};return{single:function(e){return void 0===e&&(e=!0),t.single=e,this},notImmediate:function(e){return void 0===e&&(e=!1),t.immediate=e,this},once:function(e){return void 0===e&&(e=!0),t.once=e,this},index:function(e){return t.index=e,this},head:function(){return t.head=!0,this},tail:function(){return t.tail=!0,this},name:function(e){return t.name=e,this},orderBefore:function(e){return void 0===e&&(e=!0),t.orderBefore=e,this},order:function(e){return t.order=e,this},listener:function(e){return t.listener=e,this},times:function(e){return t.times=e,this},listen:function(e){return e&&(t.listener=e),O(t)}}}(e)}function O(e){var t=e.once,r=void 0!==t&&t,n=e.immediate,i=void 0===n||n,o=e.eventName,u=e.listener,s=e.order,f=e.orderBefore,d=e.index,a=e.single,c=e.name,l=e.head,m=e.tail,h=e.times;return y(o)||b(o),v(o).regist({listener:u,once:r,immediate:i,order:s,orderBefore:f,index:d,single:a,name:c,head:l,tail:m,times:h})}t.default={version:"0.0.6",EVENT:m(),emit:function(e,t){return y(e)||b(e),v(e).emit(t)},onEmit:function(e){s=e},regist:x,onRegist:function(e){u=e},checkEvent:y,remove:function e(t,r,i){if("object"==typeof t)return i=r,null===t?(console.error("参数错误",t),!1):e(t.eventName,t.id,i);if("object"==typeof t){var o=t;return e(o.eventName,o.id)}return y(t)?n(r)?(console.error("请传入要移除的listener 或 id"),!1):v(t).remove(r,i):(console.warn("removeEvent:未找到事件 "+t),!1)},clear:function e(t){"string"==typeof t||"number"==typeof t?y(t)&&(v(t).clear(),function(e){delete c[g(e)],delete l[g(e)]}(t)):t instanceof Array?t.forEach((function(t){e(t)})):h()},order:function(e){return y(e)?v(e).order:-1},registNotImmediate:function(e,t){return x(e,{immediate:!1,listener:t})},registNotImmediateOnce:function(e,t){return x(e,{immediate:!1,once:!0,listener:t})},registOnce:function(e,t){return x(e,{once:!0,listener:t})},registSingle:function(e,t){return x(e,{single:!0,listener:t})}}}]).default}));